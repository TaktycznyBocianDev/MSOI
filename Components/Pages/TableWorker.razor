@page "/"
@using MSOI.Models
@using MSOI.Services
@inject WorkerService WorkerService

<MudContainer>
    <MudGrid>
        <!-- Lewa sekcja: Lista Pracowników -->
        <MudItem xs="13" md="7">
            <MudTable T="WorkerModel" Items="@workers" Hover="true" Breakpoint="Breakpoint.Sm" @ref="mudTable"
            RowClass="cursor-pointer" OnRowClick="RowClickEvent">
                <ToolBarContent>
                    <MudGrid>
                        <MudItem xs="12" md="6">
                            <MudText Typo="Typo.h3">Pracownicy</MudText>
                        </MudItem>
                        <MudItem xs="12" md="6">
                             @* <MudText Typo="Typo.h6">Wpisz imie, aby wyszukać:</MudText>  *@
                            <MudTextField T="string" ValueChanged="@(s=>SetWorkerName(s))" Placeholder="Wpisz imie" Adornment="Adornment.Start"
                                          AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
                            <MudTextField T="string" ValueChanged="@(s=>SetPesel(s))" Placeholder="Wpisz PESEL" Adornment="Adornment.Start"
                                          AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
                        </MudItem>       
                    </MudGrid>                    
                </ToolBarContent>
                <HeaderContent>
                    <MudTh>Nr</MudTh>
                    <MudTh>Imie</MudTh>
                    <MudTh>Nazwisko</MudTh>
                    <MudTh>PESEL</MudTh>
                    <MudTh>Stanowisko</MudTh>
                    <MudTh>Data zatrudnienia</MudTh>
                    <MudTh>Edytuj</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Nr">@context.Id</MudTd>
                    <MudTd DataLabel="Imie">@context.Worker_name</MudTd>
                    <MudTd DataLabel="Nazwisko">@context.Worker_surname</MudTd>
                    <MudTd DataLabel="PESEL">@context.Pesel</MudTd>
                    <MudTd DataLabel="Stanowisko">@context.Position</MudTd>
                    <MudTd DataLabel="Data zatrudnieni">@context.Employment_date.ToString("dd.MM.yyyy")</MudTd>
                    <MudTd><MudIconButton Icon="@Icons.Material.Filled.Edit" Variant="Variant.Filled" Color="Color.Secondary" Size="Size.Small" /></MudTd>
                </RowTemplate>
            </MudTable>
        </MudItem>


        <!-- Prawa sekcja: Przyporządkowane przedmioty -->
        <MudItem xs="11" md="5">
            <MudCard Class="p-4">
                <MudCardContent>
                    @if (!showItems)
                    {
                        <MudAlert Severity="Severity.Info" Class="mt-4">
                            Wybierz pracownika, aby wykazać jego przedmioty.
                        </MudAlert>
                    }
                    else
                    {
                        <MudAlert Severity="Severity.Info" Class="mt-4">
                            YEEEEEEEEEEEEEEEEEEEEEET
                        </MudAlert>
                    }

                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>
</MudContainer>

@code
{

    public List<WorkerModel>? workers = new List<WorkerModel>();
    public bool showItems = false;
    private MudTable<WorkerModel> mudTable;

    private string workerName;
    private string pesel;


    protected override async Task OnInitializedAsync()
    {
        workers = await WorkerService.GetWorkers();
    }

    private async Task SetWorkerName(string name)
    {
        workerName = name;
        await SearchWorkers();
    }

    private async Task SetPesel(string pesel)
    {
        this.pesel = pesel;
        await SearchWorkers();
    }

    public async Task SearchWorkers()
    {
        workers = await WorkerService.GetWorkers(name: workerName, pesel: pesel);
    }

    public void ShowItems()
    {
        showItems = true;
        StateHasChanged();

    }

    private void RowClickEvent(TableRowClickEventArgs<WorkerModel> args)
    {
        ShowItems();
    }



}